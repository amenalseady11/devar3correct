
      <style type="text/css">
         .invoice-actions.btn-group.dropdown-btn-group {
         /*border: 1px solid #d8d8d8;*/
         }
         .invoice-actions .btn-default {
         color: #444!important;
         background-color: #fff;
         border-color: #ddd #ddd #d8e1e3 !important;
         border: 1px solid #d8d8d8;
         font-size: 13px;
         }
         .dropdown-menu {
         border: 1px solid #ddd;
         border-radius: 2px;
         -webkit-box-shadow: 0 2px 6px rgb(0 0 0 / 10%);
         box-shadow: 0 2px 6px rgb(0 0 0 / 10%);
         }
         .dropdown-menu>li>a {
         clear: both;
         font-weight: 400;
         line-height: 1.42857143;
         color: #333;
         white-space: nowrap;
         border: 1px solid transparent;
         padding: 12px 15px;
         }
         .nav>li {
         position: relative;
         display: block;
         }
         .nav-tabs > li > a {
         position: relative;
         display: block;
         font-size: 15px;
         font-weight: 600;
         color: #000;
         padding: 10px 15px;
         border-radius: 2px 2px 0 0;
         border-bottom: 1px solid #ddd;
         /*background-color: #fff;*/
         /*border: 1px solid #ddd;*/
         color: #555;
         }
         .nav-tabs>li>a.active, .nav-tabs>li>a.active:focus, .nav-tabs>li>a.active:hover {
         color: #555;
         cursor: default;
         background-color: #fff;
         border: 1px solid #ddd;
         border-bottom-color: transparent;
         }
         .nav-tabs>li>a.active{
         border-bottom-color: #fff!important;
         }
         .tab-content {
         padding: 20px;
         border: 1px solid #dee5e7;
         border-top: none;
         }
         .tab-content {
         overflow: unset;
         }
         .nav-tabs {
         border-bottom: 1px solid #ddd;
         }
         .nav-tabs>li {
         float: left;
         margin-bottom: -2px;
         }
         .invoice-wrap {
         width: 700px;
         margin: 0 auto;
         background: #FFF;
         color: #000;
         }
         .invoice-inner {
         margin: 0 30px;
         padding: 20px 0;
         }
         #invoice_id{
         /*background: rgb(195, 195, 195);*/
         padding: 20px;
			 
         }
         .invoice-listing-table th {
         background-color: #e5e5e5;
         border-bottom: 1px solid #555555;
         border-top: 1px solid #555555;
         font-weight: bold;
         text-align: left;
         padding: 6px 4px;
         }
         .invoice-listing-table td {
         border-bottom: 1px solid #555555;
         text-align: left;
         padding: 5px 6px;
         vertical-align: top;
         }
         .total-row {
         background-color: #e5e5e5;
         /*border-bottom: 1px solid #555555;*/
         /*border-top: 1px solid #555555;*/
         }
         .total-table td {
         border-left: 1px solid #555555;
         }
         .total-table td:last-child {
         border-right: 1px solid #555555;
         }
         .total-table th:last-child {
         border-right: 1px solid #555555;
         }
         .invoice-wrap h1 {
         font-size: 28px;
         }
         .invoice-wrap table {
         font-size: 12px;
         }
         .invoice-address {
         padding-top: 20px;
         border-top: 1px solid darkgrey;
         }
         div#payment_id {
         position: relative;
         }
         .btn_rightcss{
         position: absolute;
         right: 0;
         top: 0;
         }
         .day-view-entry table {
         line-height: 18px;
         width: 100%;
         }
         .day-view-entry-list {
         padding-left: 0;
         list-style: none;
         margin-bottom: 0px;
         /*margin-top: 30px;*/
         }
         .day-view-entry-label.day-view-entry-label {
         position: relative;
         border: none;
         border-left: 3px solid #ddd;
         }
         .day-view-entry {
         border-bottom: 1px solid #ddd !important;
         font-size: 13px;
         -webkit-transition: background 0.1s linear;
         -moz-transition: background 0.1s linear;
         -ms-transition: background 0.1s linear;
         -o-transition: background 0.1s linear;
         transition: background 0.1s linear;
         }
         .day-view-entry td {
         padding: 16px 15px 16px 30px;
         }
         .day-view-entry td {
         vertical-align: middle;
         padding: 16px 15px;
         word-wrap: break-word;
         }
         .day-view-entry .entry-info {
         word-wrap: break-word;
         }
         .day-view-entry .task-notes {
         margin-top: 8px;
         color: #777;
         overflow: hidden;
         }
         .day-view-entry .task-notes a{
         color: #777;
         overflow: hidden;
         }
         .day-view-entry .task-notes a span.project{
         color: #000;
         overflow: hidden;
         }
         .day-view-entry .project-client, .day-view-entry .start-time {
         font-size: 14px;
         font-weight: bold;
         margin-bottom: 3px;
         -webkit-font-smoothing: antialiased;
         font-smoothing: antialiased;
         }
         .day-view-entry .task-notes {
         color: #777;
         overflow: hidden;
         }
         .meta-details.tiny {
         font-size: 11px;
         line-height: 11px;
         }
         .meta-details {
         float: left;
         padding: 0;
         list-style-type: none;
         }
         .day-view-entry .entry-time {
         vertical-align: middle;
         padding: 16px 15px;
         font-size: 21px;
         font-weight: 700;
         text-align: right;
         width: 155px;
         white-space: nowrap;
         -webkit-font-smoothing: antialiased;
         font-smoothing: antialiased;
         }
         .day-view-entry .entry-button {
         line-height: 37px;
         padding-left: 0;
         text-align: right;
         width: 80px;
         text-align: right;
         }
         .project-client a {
         color: black;
         }
         .sub_with_num {
         font-size: 11px;
         color: #777;
         display: inline-block;
         font-weight: normal;
         }
         .bordered {
         margin-top: 30px;
         border: 1px solid #DDD;
         }
         .wid_ri {
         width: 410px;
         margin-top: 10px;
         }
         .wid_ri a{
         margin-top: 0px !important;
         width: 200px;
         display: inline-block;
         }
         .day-view-entry .task-notes2 {
         margin-top: 8px;
         color: #777;
         overflow: hidden;
         }
         .task-notes2 span {
         margin-right: 10px;
         }
         a.new_seca {
         padding: 0px 5px;
         color: #000;
         }
         .new_bbtn {
         color: #fff;
         background-color: #e81f8a;
         border-color: #e81f8a;
         padding: 10px 15px;
         }
         .day-view-entry .entry-button {
         line-height: 37px;
         padding-left: 0;
         text-align: right;
         width: 80px;
         }
         .new_bbtn::after {
         margin-left: 0em;
         }
         table.table.table-hover.mb-0.text-md-nowrap td{
            padding: 10px 20px;
    border-bottom: 1px solid #e5e2f5 !important;
    color: #575757;
    font-size: 13px;
    font-weight: 500;
         }
         table.table.table-hover.mb-0.text-md-nowrap th {
    padding: 10px 20px;
    font-weight: 600;
    background-color: #f2f1f9;
        font-size: 13px;
}
table.table.table-hover.mb-0.text-md-nowrap {
  margin-top: 20px;
}
#timeline_content {
    overflow: hidden;
}
.timeline-wrapper {
    position: relative;
    text-align: center;
}
.timeline-wrapper:before {
    position: absolute;
    left: 63px;
    top: 0;
    bottom: 50px;
    content: '';
    width: 3px;
    background: #e6e3f6;
}
.date-label {
    position: relative;
    z-index: 9;
    text-align: left;
    width: 100%;
    margin-bottom: 20px;
    overflow: hidden;
}
.date-label p {
 display: inline-block;
    padding: 10px 20px;
    background: #e4e1f4;
    border-radius: 4px;
    text-align: center;
    margin: 0;
    color: #000;
    min-width: 130px;
    font-weight: bold;
    text-transform: uppercase;
}
.extended .timeline-item {
    margin-left: 160px;
}
.timeline-item {
    text-align: left;
    border: 2px solid #ddd;
    background: #fff;
    border-radius: 4px;
    padding: 15px;
    position: relative;
    margin-left: 80px;
    margin-bottom: 20px;
    /* max-width: 510px; */
}
.item-wrapper .timeline-item:before {
    left: -24px;
    right: auto;
    content: '';
    border: 11px solid transparent;
    border-right: 11px solid #ddd;
}
.timeline-item:before {
    position: absolute;
    right: -24px;
    content: '';
    top: 19px;
    border: 11px solid transparent;
    border-left: 11px solid #ddd;
}
.timeline-item > span {
    font-size: 13px;
    color: #222;
}
.item-wrapper .timeline-item:after {
    left: -20px;
    right: auto;
    border: 10px solid transparent;
    border-right: 10px solid #fff;
}
.timeline-item:after {
    position: absolute;
    right: -20px;
    top: 20px;
    content: '';
    border: 10px solid transparent;
    border-left: 10px solid #fff;
}
.extended .extend {
     left: -160px;
    top: 5px;
    background: #c5176c;
    border: 0px solid #c5176c;
    border-radius: 5px;
    width: 130px;
    height: 35px;
    line-height: 35px;
    text-align: center;
    color: #fff;
    font-size: 14px;
}

.timeline-item > span {
    font-size: 13px;
    color: #222;
}
.extend {
    position: absolute;
    right: -37px;
    top: 20px;
    background: #307bb3;
    border: 4px solid #eee;
    border-radius: 50%;
    width: 20px;
    height: 20px;
}
.extended .extend i {
    color: #fff;
    line-height: 42px;
}
.timeline-item p {
    margin-bottom: 0;
}
.invoice-actions a:hover {
    color: #d61a75 !important;
}
.btn-success2{
    color: #fff;
    background-color: #e81f8a;
    border-color: #e81f8a;
}
.btn-success2:hover{
    color: #fff;
    background-color: #e81f8a;
    border-color: #e81f8a;
}
.btn-outline-success2{
      border: 1px solid #e81f8a;
           color: #e81f8a;
           background-color: #fff;
}
.btn-outline-success2:hover{
      border: 1px solid #e81f8a;
           color: #fff;
           background-color: #e81f8a;
}
.FilterDiv .panel-heading {
    padding: 10px 0px;}
    .FilterDiv .panel-body {
    padding: 0px;
}
      </style>
   
      
         <!-- main-content opened -->
         <div class="main-content horizontal-content">
            <!-- container opened -->
            <div class="container">
               <!-- breadcrumb -->
               <div class="breadcrumb-header justify-content-between">
                  <div>
                     <h4 class="content-title mb-2">Hi, welcome back!</h4>
                     <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                           <li class="breadcrumb-item"><a href="#">Dashboard</a></li>
                           <!-- <li class="breadcrumb-item active">Category</li> -->
                           <li class="breadcrumb-item active" aria-current="page">Invoice List</li>
                        </ol>
                     </nav>
                  </div>
               </div>
               <!-- /breadcrumb -->
               <!-- main-content-body -->
              <div class="main-content-body">
                  <div class="row row-sm">
                     <!--div-->
                     <div class="col-xl-12">
                        <div class="card mg-b-20">
                           
                           <div class="card-body">
							   <div class="row">
								    <form method="post" action="<?php echo base_url()?>/task/add_comments_update">
								  <input type="hidden" name="orderid" value="<?php echo $orderid?>" >
							   <table class="data table table-order-items" id="my-orders-table" summary="Items Ordered" style="width:1300px">  
								   <?php
	if($tasks['priority']=="High")
		{
			
			$class="danger";
			
		}
		else if($tasks['priority']=="Normal")
		{
			
			$class="warning";
			
		}
		else if($tasks['priority']=="Low")
		{
			
			$class="info";
			
		}
	
	?>
   <thead>
      <tr>
         <th style="width: 35%;">Task Assigned Date:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<?php echo date("d F Y H:i:s A", strtotime($tasks['assigned_date'])); ?></th>
         <th style="width: 25%;">Due date:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<?php echo date("d F Y", strtotime($tasks['duedate'])); ?></th>
         <th style="width: 15%;">Priority:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="badge badge-<?php echo $class?>"><?php echo $tasks['priority']?></span></th>
        <th>status:</th>
        <th>
            <select name="status" id="status" class="form-control"><option value="Processing" <?php if($tasks['status']=="Processing"){ echo "selected";} ?>>Processing</option>
		<option value="Completed" <?php if($tasks['status']=="Completed"){ echo "selected";} ?>>Completed</option>
										   <option value="OnHold" <?php if($tasks['status']=="OnHold"){ echo "selected";} ?>>OnHold</option></select></th>
                                           <th><button type="submit" class="btn btn-primary" id="statusbtn">Submit</button></th>
      </tr>
   </thead>
   <tbody>
	   <tr>
		   <td>Task Details:&nbsp;&nbsp;&nbsp;<?php echo $tasks['details']?></td>
		   <td></td>

		  
		   
		   <td colspan="3"><span id="co_id">Comments</span>
            <textarea name="comments_new" rows="3" cols="25" id="comments_new" class="form-control"></textarea></td>
		   <td></td>
	   </tr>
	   
	   
	  
								   </tbody>
								   </table>
								   
								  
								   
		
									   </form>
							   </div>
							   
							   <div class="row">
							    <table class="data table table-order-items" id="my-orders-table" summary="Items Ordered">   
   <thead>
      <tr>
         <th class=" name" width="50%">Product Name</th>
         <!-- <th class="col price" width="200">Price</th> -->
         <th class=" qty" width="30%">Quantity</th>
        
      </tr>
   </thead>
   <tbody>
	   <?php 
				$total="0";
				 $tot="0";
	 $prdcount=count($order_details);
				foreach ($order_details as $items)
{
					
					
					$total=$total+$item['price'];
					
					
	
					$options=json_decode($items['product_options']);
					
					?>
      <tr id="order-item-row-40">
         <td class=" name" data-th="Product Name" style="">
            <strong class="product name product-item-name"><b><?php echo $items['name']?></b></strong>
            <div class="at_box show_3" >
            	<div class="attribute_box ">
            <?php		foreach ($options as $key=>$value)
							 {
						
						$subprice=$items['price']*$items['qty'];
								 
						?>
           
              <div class="dependable-attribute">
             <?php
						echo $value->name." : <b>".$value->value."</b>";
						?>
            </div>
			  <?php } ?>
            <?php if($items['comments']){?>
			  
			   <div class="dependable-attribute">
           
						comments : <b><?php echo $items['comments'] ?></b>
						
            </div>
			  <?php } ?>
					
					 <?php $itemid=$items['id']; ?>
			  
			  <?php foreach($filearr[$itemid] as $val){
						
						$file=$val['order_file_name'];
						
			  
			  $ext = pathinfo($file, PATHINFO_EXTENSION);
						
						
			  ?>
						
						<div class="dependable-attribute">
							<?php if($ext=="jpg" || $ext=="jpeg" || $ext=="png" || $ext=="gif"){
				  
			             ?>
           
						uploaded files : <img src="<?php echo base_url()?>assets/uploads/<?php echo $val['order_file_name'] ?>" width="100" height="auto">
							<?php } else {?>
							
							uploaded files : <a href="<?php echo base_url()?>assets/uploads/<?php echo $val['order_file_name'] ?>"><?php echo $val['order_file_name'] ?></a>
           
			  <?php } ?>
							
							 </div>
						
						
				<?php	}
					
             ?>
         
             
        </div>
   <div class="show_hide">View More</div>

        </div>
         </td>

         <td class=" qty" data-th="Qty">
           <?php echo $items['qty']?>
                  	
         </td>
         
      </tr>
       <?php } 
	   
	   
	   ?>
   </tbody>
   <tfoot>
	  

	    
      
   </tfoot>
</table>
							   </div>
							   
                              <div class="row ">
                                 <div class="col-12 col-lg-12">
                                    <div id="FilterDiv" class="filter-results rounded-item panel panel-default listing-filters">
                                       
                                       <div class="panel-body ">
                                          <ul class="nav nav-tabs">
											  <input type="hidden" name="ordid" id="ordid" value="<?php echo $orderid;?>">
                                             
                                             <li><a data-toggle="tab" href="#activitylog" class="active show" onclick="ref();">History </a></li>
											  <li><a data-toggle="tab" href="#invoice_id" >Comments</a></li>
                                             <li><a data-toggle="tab" href="#payment_id">Attachments</a></li>
                                          </ul>
                                          <div class="tab-content">
											  
											               <div id="activitylog"  class="tab-pane fade in active show">
                                                <!-- <h3>Menu 2</h3> -->
                                                <br>
                                             <div id="timeline_content"><div id="timeline_content">
    <div class="timeline-wrapper mobile-timeline-wrapper">
        <div class="date-label">
      <p>Activity Log</p>
    </div>
    <?php $i="1"; 
 //print_r($history);
   $tot=count($history);
		//print_r($order_details);
		
		
    ?>
    <?php foreach ($history as $his){

       //$j=$tot-$i;

       
      
    
    
		
		$name=$his->task;
		
		
		
	//echo "mmm".$order_details[$i]['status'];
	
	$taskstatus=$task_status['status'];
	

    //echo $name."<br>";


       ?>
        <div class="item-wrapper extended timeline_invoice timeline_add_invoice">
      <div class="timeline-item"> <span class="extend"><?php echo date("d-m-Y", strtotime($his->activity_date)); ?></span>
        <p> <strong><?php //echo $his->type?></strong> Task <?php //echo $taskstatus?>:&nbsp;<?php echo $name; ?></p>
        <span><i class="fa fa-clock-o"></i><?php echo date("H:i:s", strtotime($his->activity_date)); ?>  - <i class="fa fa-user"></i> <?php echo $userhistory[$i]['fullname'];?></span> </div>
    </div>
    <?php 
    $i=$i+1;
   } ?>
      

  </div>
</div>

<!-- Initialize the plugin: -->

</div>
                                             </div>
                                             <div id="invoice_id" class="tab-pane fade">
                                              <h3>Comments</h3>
                                                
                                                <div class="bordered">
                                                   <ul class="day-view-entry-list">
                                                      <li class="day-view-entry day-view-entry-label">
                                                        
                                                      </li>
                                                      <li class="day-view-entry day-view-entry-label">
                                                         <table cellspacing="0" cellpadding="0" border="0">
                                                            <tbody>
                                                               <tr>
                                                                  <td width="50%" class="clickable" data-url="#">
                                                                     <div class="invoice-row entry-info">
																		<div class="form-group">
    <label for="exampleFormControlTextarea1">Comments</label>
    <textarea class="form-control"  rows="3" name="comments" id="comments"></textarea>
  </div>
                                                                     </div>
                                                                  </td>
                                                                  <td style="" class="">
                                                                     <a href="#" class="btn ripple btn-primary mb-3 mb-xl-0" id="savecomments">Add Comments</a>
                                                                  </td>
                                                                  <td class="entry-time">
                                                                    
                                                                  </td>
                                                                  <td class="entry-button">
                                                                     
                                                                  </td>
                                                               </tr>
                                                            </tbody>
                                                         </table>
                                                      </li>
                                                   </ul>
                                                </div>
<br><br>
                                                  <h3>Comments Summary</h3>
<div class="table-responsive">
                                                 <table  class="table table-hover mb-0 text-md-nowrap">
                    <thead>
                      <tr>
                        <th>Date</th>
						  
						  <th>User</th>
                     
                        <th>Comments</th>
						  
						  <th>Action</th>
                     
                        
                      </tr>
                        <tbody id="listRecords">                    
	</tbody>
                       
                    </thead>
                                                  </table>
                                                </div>
                                             </div>
                                             <div id="payment_id" class="tab-pane fade">
                                                <h3>Attachments</h3>
                                               
                                                <div class="bordered">
                                                   <ul class="day-view-entry-list">
                                                      <li class="day-view-entry day-view-entry-label">
														  <form class="form-horizontal" id="upload-form" >
                                                         <table cellspacing="0" cellpadding="0" border="0">
                                                            <tbody>
                                                                <tr>
                                                                  <td width="50%" class="clickable" data-url="#">
                                                                     <div class="invoice-row entry-info">
																		<div class="form-group">
																			<label for="exampleFormControlTextarea1">Document Name</label>
    <input type="text" name="document" id="document" >
    <label for="exampleFormControlTextarea1">File</label>
    <!--<input type="file" name="attachment" id="attachment">-->
																			
	<input type="file"  id="customFile" name="upl_file">
																			<span>(gif,png,jpg,jpeg,pdf,docx,doc) size(Max 10 MB)</span>
																			
		<span id="chk-error"></span>																	
																			
	<input type="hidden" name="orderid" id="orderid" value="<?php echo $orderid;?>">
  </div>
                                                                     </div>
                                                                  </td>
                                                                  <td style="" class="">
                                                                     <button  type="submit" class="btn btn-primary" name="submit" id="upload-file">Add File</button>
                                                                  </td>
                                                                  <td class="entry-time">
                                                                    
                                                                  </td>
                                                                  <td class="entry-button">
                                                                     
                                                                  </td>
                                                               </tr>
                                                            </tbody>
                                                         </table>
														  </form>
                                                      </li>
                                                      <li class="day-view-entry day-view-entry-label">
                                                         
                                                      </li>
                                                   </ul>
                                                </div>
<br><br>
												 
												 <div class="row align-items-center">
          <div class="col">
            <div class="progress" style="display: none;">
              <div id="file-progress-bar" class="progress-bar"></div>
           </div>
         </div>
        </div>
        <div class="row align-items-center">  
          <div class="col">
            <div id="uploaded_file"></div>
        </div>
      </div>
 
												 
												
                                                  <h3>Attachments Summary</h3>
<div class="table-responsive">
                                                 <table  class="table table-hover mb-0 text-md-nowrap">
                    <thead>
                      <tr>
                        <th>SL No</th>
                        <th>Document Name</th>
						  <th>Uploaded Date</th>
                        <th>Attachment File Details</th>
                     <th>Action</th>
						  <th></th>
                        
                      </tr>
                        <tbody id="listFiles">                    
	</tbody>
                    </thead>
                                                  </table>
                                                </div>
                                             </div>
                                
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <!--/div-->
                     </div>
                  </div>
                  <!-- /row -->
               </div>
               <!-- /container -->
            </div>
            <!-- /main-content -->
            <!-- /main-content -->
	<script>
		
		listComments();
		listFiles();
		
		$('body').on('click','#savecomments',function(){
			
		var comment = $('#comments').val();
			
			var ordid = $('#ordid').val();
			
			if(comment=="")
				{
				  alert("Please enter Comments");
					return false;
				}
			
			
			//return false;
		
		$.ajax({
			type : "POST",
			url  : "<?php echo base_url(); ?>task/add_comments",
			dataType : "JSON",
			data : {comments:comment, orderid:ordid},
			success: function(data){
				//alert(data);
				$('#comments').val("");
				
				listComments();
			}
		});
		return false;
	});
		
		function listComments(){
			
			
			var ordid = $('#orderid').val();
			
			//alert(ordid);
			
			
	$.ajax({
		type  : 'POST',
		url   : '<?php echo base_url(); ?>task/show_comments',
		async : false,
		dataType : 'json',
		data : {orderid:ordid},
		success : function(data){
			//alert("mmmmm");
			//alert(data);
			var html = '';
			var i;
			var j;
			
			for(i=0; i<data.length; i++){
				var j=i+1;
				var newstr=data[i].comment_date;
				
				
			var newstrarr=newstr.split(' ');
				var datearr=newstrarr[0].split('-');
				var newdate1=datearr[2]+ "-" +datearr[1]+ "-" +datearr[0];
				
				html += '<tr id="'+data[i].comment_id+'">'+
					     '<td>'+newdate1+'</td>'+
					'<td>'+data[i].fullname+'</td>'+
						'<td>'+data[i].comments+'</td>'+
					    '<td>'+'<button class="btn btn-danger btn-icon" value="'+data[i].comment_id+'" onclick="deletecomments('+data[i].comment_id+')" data-confirm="Are you sure to delete this item?"><i class="typcn typcn-delete"></i></button>'+'</td>'+
						
						'</tr>';
			}
			$('#listRecords').html(html);					
		}
	});
}
		
	
		function listFiles(){
			
			var ordid = $('#orderid').val();
			
	$.ajax({
		type  : 'POST',
		url   : '<?php echo base_url(); ?>task/show_files',
		async : false,
		dataType : 'json',
		data : {orderid:ordid},
		success : function(data){
			//alert("mmmmm");
			//alert(data);
			var html = '';
			var i;
			var j;
			
			for(i=0; i<data.length; i++){
				
				var newstr=data[i].file_date;
				
			var newstrarr=newstr.split(' ');
				var datearr=newstrarr[0].split('-');
				var newdate1=datearr[2]+ "-" +datearr[1]+ "-" +datearr[0];
				
				j=i+1;
				html += '<tr id="'+data[i].file_id+'">'+
					     '<td>'+j+'</td>'+
					'<td>'+data[i].document_name+'</td>'+
					'<td>'+newdate1+'</td>'+
						'<td>'+data[i].file_name+'</td>'+
					'<td>'+'<a href="<?php echo base_url()?>assets/files/'+data[i].file_name+'" target="_blank"> <i class="fas fa-file fa-2x"></i></a>'+'</td>'+
					     '<td>'+'<button class="btn btn-danger btn-icon" value="'+data[i].file_id+'" onclick="deletefiles('+data[i].file_id+')"><i class="typcn typcn-delete"></i></button>'+'</td>'+
						
						'</tr>';
                      }
						  
						  $('#listFiles').html(html);				
		}
	});
}
		
		function getFormattedDate(date) {
    let year = date.getFullYear();
    let month = (1 + date.getMonth()).toString().padStart(2, '0');
    let day = date.getDate().toString().padStart(2, '0');
  
    return month + '/' + day + '/' + year;
}
		
		 $('#submit').submit(function(e){
			// alert("jjjj");
         var ext = $('#attachment').val().split('.').pop().toLowerCase();
if($.inArray(ext, ['gif','png','jpg','jpeg','pdf','docx','doc']) == -1) {
    alert('invalid extension!');
    return false;
}
			 
			 if( $('#document').val()=="")
				 {
					 
					alert("Please Enter Document Name");
					  return false;
					 
				 }


            e.preventDefault(); 
                 $.ajax({
                     url:'<?php echo base_url();?>task/attachment_upload',
                     type:"post",
                     data:new FormData(this),
                     processData:false,
                     contentType:false,
                     cache:false,
                     async:false,
                      success: function(data){
						 // alert(data);
						  $('#document').val("");
						   $('#attachment').val("");
						  listFiles();
                         
                   }
                 });
            });


		
		
		
            function deletecomments(coid)
           {
			   
			  // alert(coid);
			   
			  var result = confirm("Are you sure to delete?");
    if(result){

        var cid = coid;
			   
			  $.ajax({
			type : "POST",
			url  : "<?php echo base_url(); ?>task/delete_comments",
			dataType : "JSON",
			data : {comment_id:cid},
			success: function(data){
				//alert(data);
				//$('#comments').val("");
				
				listComments();
			}
		});
		
	}
           }
		
		
            function deletefiles(fid)
           {
			   
			  // alert(coid);
			  var result = confirm("Are you sure to delete?");
    if(result){


        var fileid = fid;
			   
			  $.ajax({
			type : "POST",
			url  : "<?php echo base_url(); ?>task/delete_files",
			dataType : "JSON",
			data : {file_id:fileid},
			success: function(data){
				//alert(data);
				//$('#comments').val("");
				
				listFiles();
			}
		});
		
	}
           }
           
           

           
           function ref()
           {

          window.location.reload();

           }
	/*	
		 $("#submit").on('submit',function(e)
                   {
			 
			 alert("mmmmm");
    e.preventDefault();   
       $(this).ajaxSubmit(
       
           {
            beforeSend:function()
               {
                $("#prog").show();
                $("#prog").attr('value','0');
                   
               },
               uploadProgress:function(event,position,total,percentCompelete)
               {
                  $("#prog").attr('value',percentCompelete); 
                   $("#percent").html(percentCompelete+'%');
               },
               success:function(data)
               {
                   $("#here").html(data);
               }
           });
   });
   
   */
		
		
               
			 </script>	

<script type="text/javascript">
    jQuery(document).on('submit', '#upload-form', function(e){
		//alert("hhhhhhhh");
		 if( jQuery('#document').val()=="")
				 {
					 
					alert("Please Enter Document Name");
					  return false;
					 
				 }
		
		var ext = jQuery('#customFile').val().split('.').pop().toLowerCase();
		//alert(ext);
		var imagesize=$("#customFile")[0].files[0].size;
		if(imagesize > 10000000)
			{
			
				alert("Please upload file less than 10MB. Thanks!!");
				return false;
				
			}
		
if(jQuery.inArray(ext, ['gif','png','jpg','jpeg','pdf','docx','doc']) == -1) {
    alert('invalid extension!');
    return false;
}

			 
        jQuery("#chk-error").html('');
        jQuery('.progress').show();
		 
			
        e.preventDefault();
        $.ajax({
            xhr: function() {
                var xhr = new window.XMLHttpRequest();         
                xhr.upload.addEventListener("progress", function(element) {
                    if (element.lengthComputable) {
                        var percentComplete = ((element.loaded / element.total) * 100);
						 percentComplete=parseInt(percentComplete);
                        $("#file-progress-bar").width(percentComplete + '%');
                        $("#file-progress-bar").html(percentComplete+'%');
                    }
                }, false);
                return xhr;
            },
            type: 'POST',
            url:"<?php echo base_url(); ?>task/upl",
            data: new FormData(this),
            contentType: false,
            cache: false,
            processData:false,
            dataType:'json',
            beforeSend: function(){
                $("#file-progress-bar").width('0%');
            },

            success: function(json){
				//alert("kkkkkk");
                if(json == 'success'){
                    $('#upload-form')[0].reset();
                    $('#uploaded_file').html('<p style="color:#28A74B;">File has uploaded successfully!</p>');
					listFiles();
					 $('#uploaded_file').html('');
					$("#file-progress-bar").hide();
					
                }else if(json == 'failed'){
                    $('#uploaded_file').html('<p style="color:#EA4335;">Please select a valid file to upload.</p>');
                }
            },
            error: function (xhr, ajaxOptions, thrownError) {
              console.log(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
            }
        });
    });
  
    // Check File type validation
    $("#customFile").change(function(){
        var allowedTypes = ['image/jpeg', 'image/png', 'image/jpg', 'image/gif', 'application/pdf', 'application/msword', 'application/vnd.ms-office', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
        var file = this.files[0];
        var fileType = file.type;
        if(!allowedTypes.includes(fileType)) {
            jQuery("#chk-error").html('<small class="text-danger">Please choose a valid file (JPEG/JPG/PNG/GIF/PDF/DOC/DOCX)</small>');
            $("#customFile").val('');
            return false;
        } else {
          jQuery("#chk-error").html('');
        }
    });
</script>

<script>
// Add the following code if you want the name of the file appear on select
$(".custom-file-input").on("change", function() {
  var fileName = $(this).val().split("\\").pop();
  $(this).siblings(".custom-file-label").addClass("selected").html(fileName);
});
</script>
<script type="text/javascript">
  $(".show_hide").click(function(){
$(this).parent('.at_box').toggleClass("show_3");
if ($(this).parent('.at_box').hasClass('show_3')){
 $(this).html('View More');
 } else {
 $(this).html('Less View');
   }
});
</script>

<script>	
	
	if($("#status").val()=="Processing")
			{
				
			    //document.getElementById("statusbtn").disabled = true;
				$("#comments_new").hide();
				$("#co_id").hide();
			}
			
	if($("#status").val()=="Completed")
			{
				
			   // document.getElementById("statusbtn").disabled = true;
				$("#comments_new").hide();
				$("#co_id").hide();
			}
			
	
					  $('#status').on('change', function() {
											
											
	 	if($("#status").val()=="OnHold")
			{
				
			   //document.getElementById("statusbtn").disabled = false;
				$("#comments_new").show();
				$("#co_id").show();
			}
			 else
			 {
					
				 
				// document.getElementById("statusbtn").disabled = true;
				 
				 $("#comments_new").hide();
				 $("#co_id").hide();
						 
			 }
	});
	
	$('body').on('click','#statusbtn',function(){
			
		var comment = $('#comments_new').val();
			
			if($("#status").val()=="OnHold")
				{
					
					
				
			
			if(comment=="")
				{
				  alert("Please enter Comments");
					return false;
				}
			
			}
			
	});
		
	
	
							 </script>
			 
            